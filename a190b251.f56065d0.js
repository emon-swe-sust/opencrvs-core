(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{108:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return b})),n.d(t,"toc",(function(){return s})),n.d(t,"default",(function(){return d}));var a=n(3),r=n(7),i=(n(0),n(136)),o=n(137),c={id:"mediators",title:"Mediators and FHIR"},b={unversionedId:"technology/mediators",id:"technology/mediators",isDocsHomePage:!1,title:"Mediators and FHIR",description:"As an example integration, this documents how OpenHIM Mediators can be used to request standardised FHIR resources",source:"@site/docs/technology/Mediators.mdx",slug:"/technology/mediators",permalink:"/opencrvs-core/docs/technology/mediators",version:"current",sidebar:"docs",previous:{title:"Webhook integration",permalink:"/opencrvs-core/docs/technology/webhooks"},next:{title:"Deployment",permalink:"/opencrvs-core/docs/technology/deployment"}},s=[{value:"About mediators",id:"about-mediators",children:[]},{value:"Security guidance: Mediator authorization to OpenCRVS data",id:"security-guidance-mediator-authorization-to-opencrvs-data",children:[]},{value:"Requesting the FHIR Composition for a birth event",id:"requesting-the-fhir-composition-for-a-birth-event",children:[]},{value:"Requesting the FHIR Patient data for individiuals associated with the event",id:"requesting-the-fhir-patient-data-for-individiuals-associated-with-the-event",children:[]},{value:"Requesting the FHIR Task for a birth event contianing the Birth Registration Number",id:"requesting-the-fhir-task-for-a-birth-event-contianing-the-birth-registration-number",children:[]},{value:"Requesting the FHIR Observations for a birth event",id:"requesting-the-fhir-observations-for-a-birth-event",children:[]},{value:"Getting the location data for FHIR Locations",id:"getting-the-location-data-for-fhir-locations",children:[]},{value:"National ID integration sequence diagram",id:"national-id-integration-sequence-diagram",children:[]},{value:"Including biometrics in a FHIR Observation",id:"including-biometrics-in-a-fhir-observation",children:[]}],l={toc:s};function d(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"As an example integration, this documents how ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://openhim.readthedocs.io/en/latest/user-guide/mediators.html"}),"OpenHIM Mediators")," can be used to request standardised ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://hl7.org/FHIR/"}),"FHIR")," resources\nin response to a ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"./webhooks"}),"birth registration event webhook")," to request further information on the birth record and associated demographics & biometrics."),Object(i.b)("p",null,"These resources can then be transformed into other formats, or seamlessly consumed if your system supports ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://hl7.org/FHIR/"}),"FHIR"),"."),Object(i.b)("p",null,"The ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/opencrvs/mosip-mediator"}),"code")," for this mediator represents a standardised integration of civil registraiton into National ID - specifically ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.mosip.io/"}),"MOSIP - the Modular Open Source Identity Platform"),"."),Object(i.b)("p",null,"The complete definition of our FHIR resources is hosted here:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://github.com/jembi/opencrvs-fhir-templates/blob/master/birth-registration/fhir-document.jsonc"}),"Birth registration")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://github.com/jembi/opencrvs-fhir-templates/blob/master/death-registration/fhir-document.jsonc"}),"Death registration"))),Object(i.b)("h2",{id:"about-mediators"},"About mediators"),Object(i.b)("p",null,Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://openhim.readthedocs.io/en/latest/user-guide/mediators.html"}),"Mediators")," are separate micro services that run independently to OpenCRVS and perform additional mediation tasks for a particular use case. The common tasks within a mediator are as follows:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"Message format adaptation")," - this is the transformation of messages received in a certain format into another format (eg. HL7 v2 to HL7 v3 or MHD to XDS.b)."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"Message orchestration")," - this is the execution of a business function that may need to call out to one or more other service endpoint on other systems. (eg. Enriching a message with a client\u2019s unique identifier retrieved from a client registry then sending the enriched message to a shared health record).")),Object(i.b)("p",null,"Mediators can be built using any platform that is desired (some good options are pure Java using our mediator engine, Node.js, Apache Camel, Mule ESB, or any language or platform that is a good fit for your needs).\nThe only restriction is that the mediator MUST communicate with the OpenHIM-core in a particular way."),Object(i.b)("p",null,"Mediators must register themselves with the OpenHIM-core, accept request from the OpenHIM-core and return a specialised response to the OpenHIM-core to explain what that mediator did."),Object(i.b)("p",null,"If you are interested in developing your own mediators, see the documentation available ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://openhim.readthedocs.io/en/latest/dev-guide/mediators.html"}),"here")," and see the ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://openhim.readthedocs.io/en/latest/tutorial/index.html"}),"tutorials page")," for specific examples to get you started."),Object(i.b)("h2",{id:"security-guidance-mediator-authorization-to-opencrvs-data"},"Security guidance: Mediator authorization to OpenCRVS data"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"OpenCRVS FHIR Resources contain sensitive patient data.")," When you are writing your mediator, it is your responsibility as an OpenCRVS implementor in your nation to ensure that you security check the accessing client.\nThe following steps are essential:"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Your mediator must have secure access to the ",Object(i.b)("inlineCode",{parentName:"li"},"client_id"),", ",Object(i.b)("inlineCode",{parentName:"li"},"client_secret")," and ",Object(i.b)("inlineCode",{parentName:"li"},"sha_secret")," as environment varibles returned by the registration process explained ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"./technicalInteroperability"}),"here"),"."),Object(i.b)("li",{parentName:"ol"},"The mediator's exposed client endpoints must be protected by SSL so that data is encrypted in transit."),Object(i.b)("li",{parentName:"ol"},"The endpoints must enforce JWT authentication."),Object(i.b)("li",{parentName:"ol"},"The endpoints must check the scope of the JWT before permitting any further requests for business functions you feel are relevant to that scope."),Object(i.b)("li",{parentName:"ol"},"Once the mediator has been written, tested and peer reviewed, it must be penetration tested by an equivalent independent, ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.crest-approved.org/"}),"CREST")," equivalent certified penetration testing organisation before deployment.")),Object(i.b)("p",null,"The rest of this page describes the format of raw FHIR resources that can be retrieved from OpenCRVS. To understand how to subscribe to an OpenCRVS webhook from a mediator, begin ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"./webhooks"}),"here"),"."),Object(i.b)("h2",{id:"requesting-the-fhir-composition-for-a-birth-event"},"Requesting the FHIR Composition for a birth event"),Object(i.b)("p",null,"The payload of the ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"./webhooks"}),"birth registration event webhook")," contains the ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.hl7.org/fhir/composition.html"}),"FHIR Composition")," id, that can be used to retrieve all subsequent details for the registration.\nSo, subscribing to this webhook is good place to start to begin any integration. To understand how to subscribe to a webhook from a mediator, begin ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"./webhooks"}),"here"),"."),Object(i.b)("p",null,"The FHIR Composition id is a powerful identifier and should only be accessible by approved government systems, such as those using ",Object(i.b)("inlineCode",{parentName:"p"},"health")," or ",Object(i.b)("inlineCode",{parentName:"p"},"nationalId")," JWT scopes. If you are proposing a new webhook in a feature request, consider the ",Object(i.b)("inlineCode",{parentName:"p"},"resourceType")," that your service requires, based on the explanation of the FHIR resources in the rest of this page. You should not need to expose the composition id in your mediator if your client service doesnt require it."),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Parameter"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Sample value"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"target.id")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"bab755e0-7bbd-4d90-b155-352ffa283467")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The unique ",Object(i.b)("inlineCode",{parentName:"td"},"id")," for the ",Object(i.b)("a",Object(a.a)({parentName:"td"},{href:"https://www.hl7.org/fhir/resource.html"}),"FHIR resource")," target that this webhook refers to.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"target.resourceType")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"Composition")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The ",Object(i.b)("a",Object(a.a)({parentName:"td"},{href:"https://www.hl7.org/fhir/resource.html"}),"FHIR resource")," type associated with the target ",Object(i.b)("inlineCode",{parentName:"td"},"id")," of this webhook, e.g. ",Object(i.b)("inlineCode",{parentName:"td"},"Composition")," for a ",Object(i.b)("a",Object(a.a)({parentName:"td"},{href:"https://www.hl7.org/fhir/composition.html"}),"FHIR Composition"),".")))),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"URL")),Object(i.b)("p",null,"You can request the composition payload via the OpenHIM core using an ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"./technicalInteroperability"}),"authentication token")," and Composition ",Object(i.b)("inlineCode",{parentName:"p"},"id"),"."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"GET http://openhim-core:5001/fhir/Composition/<target.id>\n")),Object(i.b)("p",null,"NOTE: If the ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"./webhooks"}),"webhook")," returned a different resourceType, you could do this:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"GET http://openhim-core:5001/fhir/<target.resourceType>/<target.id>\n")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Request headers")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"Content-Type: application/json\nAuthorization: Bearer <token>\n")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Composition payload")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),'{\n  "identifier": { "system": "urn:ietf:rfc:3986", "value": "BKBQMCD" },\n  "resourceType": "Composition",\n  "status": "preliminary",\n  "type": {\n    "coding": [\n      { "system": "http://opencrvs.org/doc-types", "code": "birth-application" }\n    ],\n    "text": "Birth Application"\n  },\n  "class": {\n    "coding": [\n      { "system": "http://opencrvs.org/doc-classes", "code": "crvs-document" }\n    ],\n    "text": "CRVS Document"\n  },\n  "title": "Birth Application",\n  "section": [\n    {\n      "title": "Birth encounter",\n      "code": {\n        "coding": [\n          {\n            "system": "http://opencrvs.org/specs/sections",\n            "code": "birth-encounter"\n          }\n        ],\n        "text": "Birth encounter"\n      },\n      "entry": [\n        { "reference": "Encounter/af7be33b-3e0c-4012-b894-c32d4bcc5100" }\n      ]\n    },\n    {\n      "title": "Child details",\n      "code": {\n        "coding": [\n          {\n            "system": "http://opencrvs.org/doc-sections",\n            "code": "child-details"\n          }\n        ],\n        "text": "Child details"\n      },\n      "entry": [{ "reference": "Patient/0a92c057-e1a6-476f-918b-7e98cb7479b8" }]\n    },\n    {\n      "title": "Mother\'s details",\n      "code": {\n        "coding": [\n          {\n            "system": "http://opencrvs.org/doc-sections",\n            "code": "mother-details"\n          }\n        ],\n        "text": "Mother\'s details"\n      },\n      "entry": [{ "reference": "Patient/5e22eea3-2e61-4dc1-8047-e216b3334c2e" }]\n    },\n    {\n      "title": "Father\'s details",\n      "code": {\n        "coding": [\n          {\n            "system": "http://opencrvs.org/doc-sections",\n            "code": "father-details"\n          }\n        ],\n        "text": "Father\'s details"\n      },\n      "entry": [{ "reference": "Patient/5e22eea3-2e61-4dc1-8047-e216b3334c2e" }]\n    },\n     {\n        "title": "Informant\'s details",\n        "code": {\n            "coding": {\n            "system": "http://opencrvs.org/specs/sections",\n            "code": "informant-details"\n            },\n            "text": "Informant\'s details"\n        },\n        "text": "",\n        "entry": [\n            {\n            "reference": "Patient/47a090fa-e7bf-457f-98a6-8f2eb60fef32"\n            }\n        ]\n    },\n    {\n        "title": "Supporting documents",\n        "code": {\n            "coding": {\n            "system": "http://opencrvs.org/specs/sections",\n            "code": "supporting-documents"\n            },\n            "text": "Supporting documents"\n        },\n        "text": "",\n        "entry": [\n            {\n            "reference": "DocumentReference/11d2b8fc-f875-49cc-96e6-2447ebfc8fc6"\n            }\n        ]\n    },\n    {\n        "title": "Certificates",\n        "code": {\n            "coding": {\n            "system": "http://opencrvs.org/specs/sections",\n            "code": "certificates"\n            },\n            "text": "Certificates"\n        },\n        "text": "",\n        "entry": [\n            {\n            "reference": "DocumentReference/301ef878-1f94-4979-b660-7ad926dd1941"\n            }\n        ]\n    }\n\n  ],\n  "subject": {},\n  "date": "2020-07-02T15:28:34.813Z",\n  "author": [],\n  "meta": {\n    "lastUpdated": "2020-07-02T15:28:35.392+00:00",\n    "versionId": "de12d2df-fac3-4f84-bc85-b665ba12b02f"\n  },\n  "id": "bab755e0-7bbd-4d90-b155-352ffa283467"\n}\n\n')),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Key payload parameters")),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Parameter"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Sample value"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"id")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"bab755e0-7bbd-4d90-b155-352ffa283467")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The unique ",Object(i.b)("inlineCode",{parentName:"td"},"id")," for the ",Object(i.b)("a",Object(a.a)({parentName:"td"},{href:"https://www.hl7.org/fhir/composition.html"}),"FHIR Composition"),".")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"identifier.value")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"BKBQMCD")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The customer facing OpenCRVS ",Object(i.b)("inlineCode",{parentName:"td"},"tracking id")," for the event application.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"resourceType")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"Composition")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The ",Object(i.b)("a",Object(a.a)({parentName:"td"},{href:"https://www.hl7.org/fhir/resource.html"}),"FHIR resource")," type associated.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"section")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"[{ ... code.coding[0].code }]")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"An array of ",Object(i.b)("a",Object(a.a)({parentName:"td"},{href:"https://www.hl7.org/fhir/composition-definitions.html#Composition.section"}),"FHIR Composition sections")," that can be filtered by code to find the appropriate resource entry ",Object(i.b)("a",Object(a.a)({parentName:"td"},{href:"https://www.hl7.org/fhir/references.html#Reference"}),"reference"),".")))),Object(i.b)("p",null,"The relevant birth registration composition section codes are:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Section"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Code"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Entry ",Object(i.b)("a",Object(a.a)({parentName:"th"},{href:"https://www.hl7.org/fhir/references.html#Reference"}),"reference")))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"Encounter")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"birth-encounter")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The ",Object(i.b)("a",Object(a.a)({parentName:"td"},{href:"https://www.hl7.org/fhir/encounter.html"}),"FHIR encounter")," is a resource encompassing the lifecycle of the event registration process")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"Child")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"child-details")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The ",Object(i.b)("a",Object(a.a)({parentName:"td"},{href:"https://www.hl7.org/fhir/patient.html"}),"FHIR patient")," resource for the child")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"Mother")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"mother-details")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The ",Object(i.b)("a",Object(a.a)({parentName:"td"},{href:"https://www.hl7.org/fhir/patient.html"}),"FHIR patient")," resource for the mother")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"Father")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"father-details")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The ",Object(i.b)("a",Object(a.a)({parentName:"td"},{href:"https://www.hl7.org/fhir/patient.html"}),"FHIR patient")," resource for the father")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"Informant")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"informant-details")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The ",Object(i.b)("a",Object(a.a)({parentName:"td"},{href:"https://www.hl7.org/fhir/patient.html"}),"FHIR patient")," resource for the informant - in case the child was registered by someone other than a parent such as a legal guardian, or a self-registration")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"Supporting documents")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"supporting-documents")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"An array of ",Object(i.b)("a",Object(a.a)({parentName:"td"},{href:"https://www.hl7.org/fhir/documentreference.html"}),"FHIR DocumentReference")," resources for all the uploaded supporting documents to validate the registration")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"Certificates")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"certificates")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"An array of ",Object(i.b)("a",Object(a.a)({parentName:"td"},{href:"https://www.hl7.org/fhir/documentreference.html"}),"FHIR DocumentReference")," resources for all birth certificates generated and printed")))),Object(i.b)("h2",{id:"requesting-the-fhir-patient-data-for-individiuals-associated-with-the-event"},"Requesting the FHIR Patient data for individiuals associated with the event"),Object(i.b)("p",null,"The ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.hl7.org/fhir/patient.html"}),"FHIR patient")," resource contains all names, addresses, contact details, gender details and other information.\nIt also contains an array of identifiers for which the created National ID, alongside other IDs such as Social Security or Birth Registration Number can be stored."),Object(i.b)("p",null,"For standardised addresses ie: states, districts and other administrative structure levels, configurable ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.hl7.org/fhir/location.html"}),"FHIR Location")," resources can be loaded into OpenCRVS and referred to by their resource ",Object(i.b)("inlineCode",{parentName:"p"},"id")," in the address.\nYou can read more about ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.hl7.org/fhir/location.html"}),"FHIR Locations")," in later sections below."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"YOUR MEDIATOR MUST FOLLOW THE SECURITY GUIDANCE ABOVE, BEFORE PERMITTING ACCESS TO SENSITIVE, IDENTIFIABLE PATIENT DATA")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"URL")),Object(i.b)("p",null,"You can request all resources via OpenHIM in subsequent individual requests following this example URL for a Patient, to retrieve the details of the mother. So the format is ",Object(i.b)("strong",{parentName:"p"},"your-openhim-core-url")," / ",Object(i.b)("strong",{parentName:"p"},"resourceType")," / ",Object(i.b)("strong",{parentName:"p"},"id")," :"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"GET http://openhim-core:5001/fhir/Patient/0a92c057-e1a6-476f-918b-7e98cb7479b8\n")),Object(i.b)("p",null,"Created from the previous composition like this:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"GET http://openhim-core:5001/fhir/<section[0].entry[0].reference>\n")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Request headers")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"Content-Type: application/json\nAuthorization: Bearer <token>\n")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Patient payload")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),'{\n  "resourceType": "Patient",\n  "active": true,\n  "id": "5e22eea3-2e61-4dc1-8047-e216b3334c2e",\n  "identifier": [\n    { "value": "123456789", "type": "NATIONAL_ID" },\n    { "value": "123456789", "type": "SOCIAL_SECURITY_NO" }\n  ],\n  "name": [{ "use": "en", "given": ["Fahmida"], "family": ["Hossein"] }],\n  "birthDate": "1971-10-23",\n  "maritalStatus": {\n    "coding": [\n      {\n        "system": "http://hl7.org/fhir/StructureDefinition/marital-status",\n        "code": "M"\n      }\n    ],\n    "text": "MARRIED"\n  },\n  "extension": [\n    {\n      "url": "http://opencrvs.org/specs/extension/patient-occupation",\n      "valueString": "Lawyer"\n    },\n    {\n      "url": "http://hl7.org/fhir/StructureDefinition/patient-nationality",\n      "extension": [\n        {\n          "url": "code",\n          "valueCodeableConcept": {\n            "coding": [{ "system": "urn:iso:std:iso:3166", "code": "ZMB" }]\n          }\n        },\n        { "url": "period", "valuePeriod": { "start": "", "end": "" } }\n      ]\n    },\n    {\n      "url": "http://opencrvs.org/specs/extension/educational-attainment",\n      "valueString": "PRIMARY_ISCED_1"\n    }\n  ],\n  "address": [\n    {\n      "type": "PERMANENT",\n      "line": [\n        "40",\n        "My street",\n        "My residential area",\n        "My city",\n        "",\n        "",\n        "URBAN"\n      ],\n      "district": "6885f574-eb70-46dd-ab89-acc9982bd63e",\n      "state": "cd5e34cb-abe0-4900-9509-28f378b8d8e8",\n      "country": "ZMB"\n    }\n  ],\n  "meta": {\n    "lastUpdated": "2020-07-04T10:15:03.286+00:00",\n    "versionId": "cf6bb775-f37e-43c5-ae16-a981a0c637d1"\n  }\n}\n')),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Key payload parameters")),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Parameter"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Sample value"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"identifier")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},'[{ value: "123456789", type: "NATIONAL_ID" }]')),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"An aray of identifiers for the patient.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"name")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},'[{ "use": "en", "given": ["Fahmida"], "family": ["Hossein"] }]')),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The ",Object(i.b)("inlineCode",{parentName:"td"},"name")," prop is extremely flexible for any language and name structure.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"extension")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},'[{ "url": "http://hl7.org ... ", "extension": ["url": "code", "valueCodeableConcept": {}], "valueString": "" }]')),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Extensions are common in FHIR and refer to standardised codes, such as ICD codes, OpenCRVS concepts, or can be custom values.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"birthDate")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"YYYY-MM-DD")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The registered date of birth of the individual")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"maritalStatus")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},'{"coding": [{"system": "http://hl7.org/fhir/StructureDefinition/marital-status","code": "M"}],"text": "MARRIED"}')),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The ",Object(i.b)("inlineCode",{parentName:"td"},"maritalStatus")," again is set using standardised codes browsable on the url supplied.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"address")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},'[{"type": "PERMANENT", line: [], "district": "6885f574-eb70-46dd-ab89-acc9982bd63e","state": "cd5e34cb-abe0-4900-9509-28f378b8d8e8","country": "ZMB"}]')),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The ",Object(i.b)("inlineCode",{parentName:"td"},"address")," type can be ",Object(i.b)("inlineCode",{parentName:"td"},"PERMANENT")," and ",Object(i.b)("inlineCode",{parentName:"td"},"CURRENT")," both or either may be required depending on civil registration legislation in the country. Address lines, districts and states can be set to ",Object(i.b)("a",Object(a.a)({parentName:"td"},{href:"https://www.hl7.org/fhir/location.html"}),"FHIR Location")," ids (explained below) to ensure statistical standardisation.")))),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Identifier parameters")),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Identifier"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Value"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"PASSPORT")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"PASSPORT"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"NATIONAL_ID")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"PASSPORT"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"DRIVING_LICENSE")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"PASSPORT"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"BIRTH_REGISTRATION_NUMBER")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"PASSPORT"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"DEATH_REGISTRATION_NUMBER")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"PASSPORT"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"REFUGEE_NUMBER")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"PASSPORT"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"ALIEN_NUMBER")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"PASSPORT"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"OTHER")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"PASSPORT"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"SOCIAL_SECURITY_NO")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"PASSPORT"))))),Object(i.b)("h2",{id:"requesting-the-fhir-task-for-a-birth-event-contianing-the-birth-registration-number"},"Requesting the FHIR Task for a birth event contianing the Birth Registration Number"),Object(i.b)("p",null,"The FHIR Task ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.hl7.org/fhir/bundle.html"}),"FHIR Bundle")," contains valuable audit information regarding the event. It contains the generated ",Object(i.b)("strong",{parentName:"p"},"Birth Registration Number")," from the event which is later saved into the Patient's identifiers."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"URL")),Object(i.b)("p",null,"To request the FHIR Task ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.hl7.org/fhir/bundle.html"}),"FHIR Bundle")," associated with the event use the Composition ",Object(i.b)("inlineCode",{parentName:"p"},"id"),":"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"http://localhost:3447/fhir/Task?focus=Composition/bab755e0-7bbd-4d90-b155-352ffa283467\n")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Request headers")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"Content-Type: application/json\nAuthorization: Bearer <token>\n")),Object(i.b)("p",null,"Multiple FHIR task Resources are returned in a ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.hl7.org/fhir/bundle.html"}),"FHIR Bundle")," containing an ",Object(i.b)("inlineCode",{parentName:"p"},"entry")," array."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Task payload")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),'{\n  "resourceType": "Bundle",\n  "id": "f249714e-006a-49ca-82d4-5ff4e4dbbd79",\n  "meta": { "lastUpdated": "2020-07-04T11:32:45.914+00:00" },\n  "type": "searchset",\n  "total": 1,\n  "link": [\n    {\n      "relation": "self",\n      "url": "http://localhost:3447/fhir/Task?focus=Composition/bab755e0-7bbd-4d90-b155-352ffa283467"\n    }\n  ],\n  "entry": [\n    {\n      "fullUrl": "http://localhost:3447/fhir/Task/b4ff04b3-7ba2-4d8f-8c8b-757f7153eb11/_history/eb02643d-f3e2-44c8-a295-c0727764a5ce",\n      "resource": {\n        "resourceType": "Task",\n        "status": "requested",\n        "code": {\n          "coding": [\n            { "system": "http://opencrvs.org/specs/types", "code": "BIRTH" }\n          ]\n        },\n        "focus": {\n          "reference": "Composition/bab755e0-7bbd-4d90-b155-352ffa283467"\n        },\n        "id": "b4ff04b3-7ba2-4d8f-8c8b-757f7153eb11",\n        "identifier": [\n          {\n            "system": "http://opencrvs.org/specs/id/draft-id",\n            "value": "bab755e0-7bbd-4d90-b155-352ffa283467"\n          },\n          {\n            "system": "http://opencrvs.org/specs/id/birth-tracking-id",\n            "value": "BKXA8V2"\n          },\n          {\n            "system": "http://opencrvs.org/specs/id/birth-registration-number",\n            "value": "2020BKXA8V2"\n          }\n        ],\n        "extension": [\n          {\n            "url": "http://opencrvs.org/specs/extension/contact-person",\n            "valueString": "FATHER"\n          },\n          {\n            "url": "http://opencrvs.org/specs/extension/contact-relationship",\n            "valueString": ""\n          },\n          {\n            "url": "http://opencrvs.org/specs/extension/contact-person-phone-number",\n            "valueString": "+260734576343"\n          },\n          {\n            "url": "http://opencrvs.org/specs/extension/timeLoggedMS",\n            "valueInteger": 490\n          },\n          {\n            "url": "http://opencrvs.org/specs/extension/regLastLocation",\n            "valueReference": {\n              "reference": "Location/43f37076-bf0e-46c6-97cb-4c2bd12dbdac"\n            }\n          },\n          {\n            "url": "http://opencrvs.org/specs/extension/regLastOffice",\n            "valueReference": {\n              "reference": "Location/531e9275-40e4-4ab5-a12c-6fa74d7b5b61"\n            }\n          },\n          {\n            "url": "http://opencrvs.org/specs/extension/regLastUser",\n            "valueReference": {\n              "reference": "Practitioner/23919090-f59c-4185-b256-69faf8b519d5"\n            }\n          }\n        ],\n        "lastModified": "2020-07-04T10:15:03.225Z",\n        "businessStatus": {\n          "coding": [\n            {\n              "system": "http://opencrvs.org/specs/reg-status",\n              "code": "REGISTERED"\n            }\n          ]\n        },\n        "meta": {\n          "lastUpdated": "2020-07-04T10:15:03.420+00:00",\n          "versionId": "eb02643d-f3e2-44c8-a295-c0727764a5ce"\n        }\n      },\n      "request": {\n        "method": "PUT",\n        "url": "Task/b4ff04b3-7ba2-4d8f-8c8b-757f7153eb11"\n      }\n    }\n  ]\n}\n\n')),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Key bundle entries")),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Entry"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Sample value"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"identifier")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},'[{"system": "http://opencrvs.org/specs/id/birth-registration-number","value": "2020BKXA8V2"}]')),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The Birth Registration Number.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"extension")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},'[{"url": "http://opencrvs.org/specs/extension/contact-person-phone-number","valueString": "+260734576343"} ...')),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The extensions contain contact details for the event. ",Object(i.b)("inlineCode",{parentName:"td"},"regLastLocation")," contains a ",Object(i.b)("a",Object(a.a)({parentName:"td"},{href:"https://www.hl7.org/fhir/location.html"}),"FHIR Location")," reference for the administrative area where the birth was registered. ",Object(i.b)("inlineCode",{parentName:"td"},"regLastOffice")," contains a ",Object(i.b)("a",Object(a.a)({parentName:"td"},{href:"https://www.hl7.org/fhir/location.html"}),"FHIR Location")," reference for the civil registration office where the birth was registered. ",Object(i.b)("inlineCode",{parentName:"td"},"regLastUser")," contains a FHIR Practitioner reference for the civil registration officer who registered the event.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"businessStatus")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},'{"coding": [{"system": "http://opencrvs.org/specs/reg-status","code": "REGISTERED"}]}')),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The ",Object(i.b)("inlineCode",{parentName:"td"},"businessStatus")," code will be either ",Object(i.b)("inlineCode",{parentName:"td"},"REGISTERED")," or ",Object(i.b)("inlineCode",{parentName:"td"},"CERTIFIED")," for a valid registration.")))),Object(i.b)("h2",{id:"requesting-the-fhir-observations-for-a-birth-event"},"Requesting the FHIR Observations for a birth event"),Object(i.b)("p",null,"A number of other configurable and unidentifiable data points can be captured for the event lifecycle, such as; who was present at the birth, what was the birth weight etc.\nFor this kind of data, we use ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.hl7.org/fhir/observation.html"}),"FHIR Observations"),"."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"URL")),Object(i.b)("p",null,"To request all the ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.hl7.org/fhir/observation.html"}),"Observations")," associated with the event use the ",Object(i.b)("inlineCode",{parentName:"p"},"birth-encounter")," resource reference:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"GET http://openhim-core:5001/fhir/Observation?encounter=Encounter/af7be33b-3e0c-4012-b894-c32d4bcc5100\n")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Request headers")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"Content-Type: application/json\nAuthorization: Bearer <token>\n")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Observations payload")),Object(i.b)("p",null,"Multiple FHIR Resources are returned in a ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.hl7.org/fhir/bundle.html"}),"FHIR Bundle")," containing an ",Object(i.b)("inlineCode",{parentName:"p"},"entry")," array."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),'{\n  "resourceType": "Bundle",\n  "id": "e4fad8cb-12b6-4deb-be72-cc8075c0692e",\n  "meta": { "lastUpdated": "2020-07-04T10:56:50.398+00:00" },\n  "type": "searchset",\n  "total": 4,\n  "link": [\n    {\n      "relation": "self",\n      "url": "http://localhost:3447/fhir/Observation?encounter=Encounter/af7be33b-3e0c-4012-b894-c32d4bcc5100"\n    }\n  ],\n  "entry": [\n    {\n      "fullUrl": "http://localhost:3447/fhir/Observation/fdbaa049-8da6-44b2-9780-e02ed70b3e73/_history/4db373f9-9b50-4c95-bfdf-f0009ef89bb5",\n      "resource": {\n        "resourceType": "Observation",\n        "status": "final",\n        "context": {\n          "reference": "Encounter/af7be33b-3e0c-4012-b894-c32d4bcc5100"\n        },\n        "category": [\n          {\n            "coding": [\n              {\n                "system": "http://hl7.org/fhir/observation-category",\n                "code": "procedure",\n                "display": "Procedure"\n              }\n            ]\n          }\n        ],\n        "code": {\n          "coding": [\n            {\n              "system": "http://loinc.org",\n              "code": "73764-3",\n              "display": "Birth attendant title"\n            }\n          ]\n        },\n        "id": "fdbaa049-8da6-44b2-9780-e02ed70b3e73",\n        "valueString": "PHYSICIAN",\n        "meta": {\n          "lastUpdated": "2020-07-04T10:15:03.246+00:00",\n          "versionId": "4db373f9-9b50-4c95-bfdf-f0009ef89bb5"\n        }\n      },\n      "request": {\n        "method": "PUT",\n        "url": "Observation/fdbaa049-8da6-44b2-9780-e02ed70b3e73"\n      }\n    },\n    {\n      "fullUrl": "http://localhost:3447/fhir/Observation/fc2f1c18-cfee-44ec-bbb6-d3d1463a950c/_history/6e8b6116-c411-478a-a07b-24d67eefbef4",\n      "resource": {\n        "resourceType": "Observation",\n        "status": "final",\n        "context": {\n          "reference": "Encounter/af7be33b-3e0c-4012-b894-c32d4bcc5100"\n        },\n        "category": [\n          {\n            "coding": [\n              {\n                "system": "http://hl7.org/fhir/observation-category",\n                "code": "vital-signs",\n                "display": "Vital Signs"\n              }\n            ]\n          }\n        ],\n        "code": {\n          "coding": [\n            {\n              "system": "http://loinc.org",\n              "code": "3141-9",\n              "display": "Body weight Measured"\n            }\n          ]\n        },\n        "id": "fc2f1c18-cfee-44ec-bbb6-d3d1463a950c",\n        "valueQuantity": {\n          "value": 1.5,\n          "unit": "kg",\n          "system": "http://unitsofmeasure.org",\n          "code": "kg"\n        },\n        "meta": {\n          "lastUpdated": "2020-07-04T10:15:03.250+00:00",\n          "versionId": "6e8b6116-c411-478a-a07b-24d67eefbef4"\n        }\n      },\n      "request": {\n        "method": "PUT",\n        "url": "Observation/fc2f1c18-cfee-44ec-bbb6-d3d1463a950c"\n      }\n    },\n    {\n      "fullUrl": "http://localhost:3447/fhir/Observation/3f7bce83-2993-4741-a436-7b99035ab427/_history/87767bc5-d70a-415b-9435-0f744a1de592",\n      "resource": {\n        "resourceType": "Observation",\n        "status": "final",\n        "context": {\n          "reference": "Encounter/af7be33b-3e0c-4012-b894-c32d4bcc5100"\n        },\n        "category": [\n          {\n            "coding": [\n              {\n                "system": "http://hl7.org/fhir/observation-category",\n                "code": "procedure",\n                "display": "Procedure"\n              }\n            ]\n          }\n        ],\n        "code": {\n          "coding": [\n            {\n              "system": "http://loinc.org",\n              "code": "57722-1",\n              "display": "Birth plurality of Pregnancy"\n            }\n          ]\n        },\n        "id": "3f7bce83-2993-4741-a436-7b99035ab427",\n        "valueQuantity": { "value": "SINGLE" },\n        "meta": {\n          "lastUpdated": "2020-07-04T10:15:03.254+00:00",\n          "versionId": "87767bc5-d70a-415b-9435-0f744a1de592"\n        }\n      },\n      "request": {\n        "method": "PUT",\n        "url": "Observation/3f7bce83-2993-4741-a436-7b99035ab427"\n      }\n    },\n    {\n      "fullUrl": "http://localhost:3447/fhir/Observation/3d4abe32-d7dc-42c8-93ab-54186a68088a/_history/47ac808e-3cde-4b80-9b5b-71ad50f89ac3",\n      "resource": {\n        "resourceType": "Observation",\n        "status": "final",\n        "context": {\n          "reference": "Encounter/af7be33b-3e0c-4012-b894-c32d4bcc5100"\n        },\n        "category": [\n          {\n            "coding": [\n              {\n                "system": "http://hl7.org/fhir/observation-category",\n                "code": "procedure",\n                "display": "Procedure"\n              }\n            ]\n          }\n        ],\n        "code": {\n          "coding": [\n            {\n              "system": "http://loinc.org",\n              "code": "present-at-birth-reg",\n              "display": "Present at birth registration"\n            }\n          ]\n        },\n        "id": "3d4abe32-d7dc-42c8-93ab-54186a68088a",\n        "valueString": "BOTH_PARENTS",\n        "meta": {\n          "lastUpdated": "2020-07-04T10:15:03.257+00:00",\n          "versionId": "47ac808e-3cde-4b80-9b5b-71ad50f89ac3"\n        }\n      },\n      "request": {\n        "method": "PUT",\n        "url": "Observation/3d4abe32-d7dc-42c8-93ab-54186a68088a"\n      }\n    }\n  ]\n}\n')),Object(i.b)("h2",{id:"getting-the-location-data-for-fhir-locations"},"Getting the location data for FHIR Locations"),Object(i.b)("p",null,"You will find many ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.hl7.org/fhir/location.html"}),"FHIR Location")," ids throughout the resources, such as place of birth, patient addresses, places of registration etc.\nThese return ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.hl7.org/fhir/location.html"}),"FHIR Location")," resources that refer either to either facilities with address and contact details, or administrative areas such as districts and states.\n",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.hl7.org/fhir/location.html"}),"FHIR Locations")," also contian multiple identifiers including an ID that should be defined by your government statistical department and aligns across all systems."),Object(i.b)("p",null,"In OpenCRVS we extend ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.hl7.org/fhir/location.html"}),"FHIR Locations")," to include other statistical data related to calculating civil registration performance estimates such as the crude birth rate & populations for a location by year."),Object(i.b)("p",null,Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.hl7.org/fhir/location.html"}),"FHIR Locations")," are saved into OpenCRVS during ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"./technicalConfiguration"}),"configuration"),"."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"URL")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"GET http://openhim-core:5001/fhir/Location/43f37076-bf0e-46c6-97cb-4c2bd12dbdac\n")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Request headers")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"Content-Type: application/json\nAuthorization: Bearer <token>\n")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Administrative area location payload, such as a state or district")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),'{\n  "resourceType": "Location",\n  "identifier": [\n    {\n      "system": "http://opencrvs.org/specs/id/statistical-code",\n      "value": "ADMIN_STRUCTURE_QTtxiWj8ONP"\n    },\n    {\n      "system": "http://opencrvs.org/specs/id/jurisdiction-type",\n      "value": "DISTRICT"\n    }\n  ],\n  "name": "Chembe District",\n  "alias": ["Chembe District"],\n  "description": "QTtxiWj8ONP",\n  "status": "active",\n  "mode": "instance",\n  "partOf": { "reference": "Location/cd5e34cb-abe0-4900-9509-28f378b8d8e8" },\n  "type": {\n    "coding": [\n      {\n        "system": "http://opencrvs.org/specs/location-type",\n        "code": "ADMIN_STRUCTURE"\n      }\n    ]\n  },\n  "physicalType": { "coding": [{ "code": "jdn", "display": "Jurisdiction" }] },\n  "extension": [\n    {\n      "url": "http://hl7.org/fhir/StructureDefinition/location-boundary-geojson",\n      "valueAttachment": {\n        "contentType": "application/geo+json",\n        "data": "<base64>"\n      }\n    },\n    {\n      url: \'http://opencrvs.org/specs/id/statistics-male-populations\',\n      valueString:\n        \'[{"2007":"1292568"},{"2008":"1250993"},{"2009":"1246376"},{"2010":"1279752"},{"2011":"1293470"},{"2012":"1291684"},{"2013":"1756173"},{"2014":"1788473"},{"2015":"1167891"},{"2016":"1225971"},{"2017":"1159078"}]\'\n    },\n    {\n      url: \'http://opencrvs.org/specs/id/statistics-female-populations\',\n      valueString:\n        \'[{"2007":"1261767"},{"2008":"1221096"},{"2009":"1214677"},{"2010":"1240638"},{"2011":"1257481"},{"2012":"1241730"},{"2013":"1724403"},{"2014":"1758485"},{"2015":"1151860"},{"2016":"1228886"},{"2017":"1168980"}]\'\n    },\n    {\n      url: \'http://opencrvs.org/specs/id/statistics-total-populations\',\n      valueString:\n        \'[{"2007":"2554927"},{"2008":"2472586"},{"2009":"2461610"},{"2010":"2520874"},{"2011":"2551523"},{"2012":"2533688"},{"2013":"3480570"},{"2014":"3546954"},{"2015":"2319748"},{"2016":"2454857"},{"2017":"2328051"}]\'\n    },\n    {\n      url: \'http://opencrvs.org/specs/id/statistics-male-female-ratios\',\n      valueString:\n        \'[{"2007":"102.4"},{"2008":"102.4"},{"2009":"102.6"},{"2010":"103.2"},{"2011":"102.9"},{"2012":"104"},{"2013":"101.8"},{"2014":"101.7"},{"2015":"101.4"},{"2016":"99.8"},{"2017":"99.2"}]\'\n    },\n    {\n      url: \'http://opencrvs.org/specs/id/statistics-crude-birth-rates\',\n      valueString:\n        \'[{"2007":"19.6"},{"2008":"19.4"},{"2009":"19"},{"2010":"18.5"},{"2011":"15.8"},{"2012":"20"},{"2013":"20.1"},{"2014":"18.7"},{"2015":"23.2"},{"2016":"19.1"},{"2017":"22.3"}]\'\n    }\n  ],\n  "meta": {\n    "lastUpdated": "2020-06-15T11:42:03.726+00:00",\n    "versionId": "688b4a56-b8a6-47c1-b635-91a501a58e39"\n  },\n  "id": "6885f574-eb70-46dd-ab89-acc9982bd63e"\n}\n')),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Facility location payload such as a civil registration office or hospital")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),'{\n  "resourceType": "Location",\n  "identifier": [\n    {\n      "system": "http://opencrvs.org/specs/id/internal-id",\n      "value": "CRVS_OFFICE_o8B4Up9xxJI"\n    }\n  ],\n  "name": "Lusaka DNRPC District Office",\n  "alias": ["Lusaka DNRPC District Office"],\n  "status": "active",\n  "mode": "instance",\n  "partOf": { "reference": "Location/43f37076-bf0e-46c6-97cb-4c2bd12dbdac" },\n  "type": {\n    "coding": [\n      {\n        "system": "http://opencrvs.org/specs/location-type",\n        "code": "CRVS_OFFICE"\n      }\n    ]\n  },\n  "physicalType": { "coding": [{ "code": "bu", "display": "Building" }] },\n  "telecom": [],\n  "address": {\n    "line": [],\n    "district": "Lusaka District",\n    "state": "Lusaka Province"\n  },\n  "meta": {\n    "lastUpdated": "2020-06-15T11:42:09.114+00:00",\n    "versionId": "0e9a6805-fdf7-453d-9473-d1eeb2d56ac0"\n  },\n  "id": "531e9275-40e4-4ab5-a12c-6fa74d7b5b61"\n}\n\n')),Object(i.b)("h2",{id:"national-id-integration-sequence-diagram"},"National ID integration sequence diagram"),Object(i.b)("p",null,"The following sequence diagram describes a Mediator that is designed to receive information from an OpenCRVS Webhook and submit it to a ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.mosip.io/"}),"MOSIP")," or National ID system webhook.\nThis use case would be for generating a National ID from a birth event. The process is likely to be asynchronous so a webhook should be designed in the National ID system also."),Object(i.b)("img",{alt:"nationalid-sequence",src:Object(o.a)("img/nationalid-sequence.png")}),Object(i.b)("h2",{id:"including-biometrics-in-a-fhir-observation"},"Including biometrics in a FHIR Observation"),Object(i.b)("p",null,"OpenCRVS is not currently designed to store biometric data and processing biometrics is outside the scope of a civil registration system currently. But the OpenCRVS team is working in partnership with ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.simprints.com/"}),"Simprints - last mile biometric identification for universal health coverage")," to define an architecture where OpenCRVS could integrate with the SImprints device and include a link to the Simprints biometrics in a FHIR Observation.\nThe format of the biometrics must conform to ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.mosip.io/platform/biometrics/cbeff-xml"}),"CBEFF XML")," for compatibility with ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.mosip.io/"}),"MOSIP"),"."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Biometric payload")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),'{\n      "fullUrl": "http://localhost:3447/fhir/Observation/fc2f1c18-cfee-44ec-bbb6-d3d1463a950c/_history/6e8b6116-c411-478a-a07b-24d67eefbef4",\n      "resource": {\n        "resourceType": "Observation",\n        "status": "final",\n        "context": {\n          "reference": "Encounter/af7be33b-3e0c-4012-b894-c32d4bcc5100"\n        },\n        "category": [\n          {\n            "coding": [\n              {\n                "system": "http://opencrvs.org/specs/extension/simprintsBiometrics",\n                "code": "biometrics",\n                "display": "Biometrics"\n              }\n            ]\n          }\n        ],\n        "code": {\n          "coding": [\n            {\n              "system": "http://opencrvs.org/specs/extension/cbeffXml",\n              "code": "CBEFF",\n              "display": "CBEFF XML"\n            }\n          ]\n        },\n        "id": "fc2f1c18-cfee-44ec-bbb6-d3d1463a950c",\n        "valueCodeableConcept": {\n          "coding": [\n            {\n              "system": "https://<your-simprints-host.com>",\n              "code": "0e9a6805-fdf7-453d-9473-d1eeb2d56ac0",\n              "display": "Simprints internal id for CBEFF XML: 0e9a6805-fdf7-453d-9473-d1eeb2d56ac0"\n            }\n          ],\n          "text": "National biometrics host resource"\n        },\n        "meta": {\n          "lastUpdated": "2020-07-04T10:15:03.250+00:00",\n          "versionId": "6e8b6116-c411-478a-a07b-24d67eefbef4"\n        }\n      },\n      "request": {\n        "method": "PUT",\n        "url": "Observation/fc2f1c18-cfee-44ec-bbb6-d3d1463a950c"\n      }\n    }\n')))}d.isMDXComponent=!0},136:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return u}));var a=n(0),r=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=r.a.createContext({}),l=function(e){var t=r.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},d=function(e){var t=l(e.components);return r.a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},h=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,s=b(e,["components","mdxType","originalType","parentName"]),d=l(n),h=a,u=d["".concat(o,".").concat(h)]||d[h]||p[h]||i;return n?r.a.createElement(u,c(c({ref:t},s),{},{components:n})):r.a.createElement(u,c({ref:t},s))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=h;var c={};for(var b in t)hasOwnProperty.call(t,b)&&(c[b]=t[b]);c.originalType=e,c.mdxType="string"==typeof e?e:a,o[1]=c;for(var s=2;s<i;s++)o[s]=n[s];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},137:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));var a=n(22),r=n(138);function i(){var e=Object(a.default)().siteConfig,t=(e=void 0===e?{}:e).baseUrl,n=void 0===t?"/":t,i=e.url;return{withBaseUrl:function(e,t){return function(e,t,n,a){var i=void 0===a?{}:a,o=i.forcePrependBaseUrl,c=void 0!==o&&o,b=i.absolute,s=void 0!==b&&b;if(!n)return n;if(n.startsWith("#"))return n;if(Object(r.b)(n))return n;if(c)return t+n;var l=n.startsWith(t)?n:t+n.replace(/^\//,"");return s?e+l:l}(i,n,e,t)}}}function o(e,t){return void 0===t&&(t={}),(0,i().withBaseUrl)(e,t)}},138:function(e,t,n){"use strict";function a(e){return!0===/^(\w*:|\/\/)/.test(e)}function r(e){return void 0!==e&&!a(e)}n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return r}))}}]);